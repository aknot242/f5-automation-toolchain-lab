# This file is used as the docker compose file for the wurstmeister kafka image

version: '3'
services:

  zookeeper:
    image: wurstmeister/zookeeper
    restart: unless-stopped
    ports:
      - "2181:2181"

  kafka:
    build: .
    restart: unless-stopped
    ports:
      - "9092"
    environment:
      KAFKA_ADVERTISED_HOST_NAME: 10.1.1.5 
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_CREATE_TOPICS: "f5-telemetry:1:1"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  graphite:
    image: "graphiteapp/graphite-statsd:1.1.5-13"
    restart: unless-stopped
    ports:
      - "3400:80"
      - "2003-2004:2003-2004"
      - "2023-2024:2023-2024"
      - "8125:8125/udp"
      - "8126:8126"
      - "8080:8080"

  elasticsearch:
    image: "elasticsearch:7.3.1"
    restart: unless-stopped
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      - discovery.type=single-node

  grafana:
    image: grafana/grafana:6.4.3
    restart: unless-stopped
    depends_on:
      - graphite
      - elasticsearch
      - zookeeper
      - kafka
    ports:
      - "3030:3000"
